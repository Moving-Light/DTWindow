<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DT Window</title>
    <link rel="stylesheet" href="style.css">
</head>
<body style="background-color: black">
    <iframe id="youtube-iframe" src="" frameborder="0"></iframe>

    <!-- Your PNG overlay -->
    <img class="overlay-image" src="media/window.png" alt="Overlay Image">
    <img class="holiday-lights" src="media/lights.gif" alt="Lights">
    <div id="train-countdown" style="position: absolute; top: 0; left: 0; color: white; font-size: 2em;"></div>


    <script>
        // Function to get the URL parameter value by name
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Get the 'code' URL parameter (for example: ?code=dQw4w9WgXcQ)
        const videoId = getUrlParameter('video');
        const holidayMode = getUrlParameter('holiday');
        const trainMode = getUrlParameter('train');


        if (videoId) {
            // Construct the YouTube iframe URL with autoplay enabled
            const iframeUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1`;

            // Set the iframe's src attribute
            document.getElementById('youtube-iframe').src = iframeUrl;
        } else {
            // If no 'code' parameter is found, display an error or a default video
            console.log("No video code provided.");
        }

        if(holidayMode === 'true') {
            document.querySelector('.holiday-lights').style.display = 'block';
        }

        if (trainMode === 'true'){
            fetchTrainArrival();
        } else {
            document.getElementById('train-countdown').style.display = 'none';
        }

        async function fetchTrainArrival() {
            const response = await fetch('https://api-v3.mbta.com/predictions?filter[stop]=place-chmnl&filter[route]=Red&sort=departure_time&api_key=bc3e9340ac314ddc90d89af5382fc28b');
            const data = await response.json();
            const arrivalTimes = data.data.map(prediction => new Date(prediction.attributes.departure_time));
            const earliestArrivalTime = Math.min(...arrivalTimes);
            updateCountdown(new Date(earliestArrivalTime));
        }

        function updateCountdown(time) {
            const now = new Date();
            const diff = time - now;
            const minutes = Math.floor(diff / 60000);
            const seconds = Math.floor((diff % 60000) / 1000);
            const display = document.getElementById('train-countdown');

            if (diff > 0) {
                display.innerText = `Next train: ${minutes}m ${seconds}s`;
                setTimeout(() => updateCountdown(time), 1000);
            } else {
                display.innerText = 'TRAIN!!!!!';
            }
        }
    </script>

</body>
</html>